<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #232323; /* OSU Black */
            font-family: 'Roboto Slab', serif;
            color: #EAEAEA;
        }
        .card {
            background-color: #2D2D2D;
            border-radius: 0.75rem;
            border: 1px solid #444;
            padding: 1.5rem;
        }
        .input-field {
            background-color: #333;
            border: 1px solid #555;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            width: 100%;
            color: #EAEAEA;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .btn-primary {
            background-color: #FF7300; /* OSU Orange */
            color: white;
            border: 2px solid #FF7300;
        }
        .btn-primary:hover { background-color: #D96400; }
        .btn-secondary {
            background-color: #555;
            color: #EAEAEA;
            border: 2px solid #777;
        }
        .btn-secondary:hover { background-color: #666; }

        .score-btn {
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .plus { background-color: #28a745; color: white; }
        .minus { background-color: #dc3545; color: white; }
    </style>
</head>
<body class="p-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold" style="font-family: 'Oswald', sans-serif;">Overlay Control Panel</h1>
        <div id="status" class="flex items-center gap-2 px-3 py-1 bg-gray-700 rounded-full text-sm">
            <span id="status-text">Connecting...</span>
            <div id="status-dot" class="w-3 h-3 bg-yellow-500 rounded-full"></div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Player 1 Card -->
        <div class="card space-y-4">
            <h2 class="text-xl font-bold text-center text-orange-500" style="font-family: 'Oswald', sans-serif;">Player 1</h2>
            <div><label class="block mb-1 text-sm font-medium">Sponsor</label><input id="p1Sponsor" type="text" class="input-field"></div>
            <div><label class="block mb-1 text-sm font-medium">Tag</label><input id="p1Tag" type="text" class="input-field"></div>
            <div><label class="block mb-1 text-sm font-medium">Pronouns</label><input id="p1Pronouns" type="text" class="input-field"></div>
            <div><label class="block mb-1 text-sm font-medium">Status (L/W)</label><input id="p1Status" type="text" class="input-field" placeholder="e.g., Winners"></div>
             <div>
                <label class="block mb-1 text-sm font-medium">Score</label>
                <div class="flex items-center gap-2">
                    <button id="p1ScoreMinus" class="score-btn minus">-</button>
                    <input id="p1Score" type="number" class="input-field text-center" value="0">
                    <button id="p1ScorePlus" class="score-btn plus">+</button>
                </div>
            </div>
            <div><label class="block mb-1 text-sm font-medium">Character</label><select id="p1Character" class="input-field"></select></div>
        </div>

        <!-- Match Info Card -->
        <div class="card flex flex-col justify-center space-y-4">
             <h2 class="text-xl font-bold text-center" style="font-family: 'Oswald', sans-serif;">Match Info</h2>
             <div><label class="block mb-1 text-sm font-medium">Round</label><input id="round" type="text" class="input-field" placeholder="e.g., Winners Finals"></div>
             <div>
                 <label class="block mb-1 text-sm font-medium">Format</label>
                 <div class="flex gap-2">
                     <select id="formatPrefix" class="input-field w-1/2">
                         <option>Best of</option>
                         <option>First to</option>
                     </select>
                     <input id="formatNumber" type="number" class="input-field w-1/2" placeholder="e.g., 5">
                 </div>
            </div>
            <button id="swapPlayers" class="btn btn-secondary w-full">Swap Players</button>
            <button id="forceUpdate" class="btn btn-primary w-full">Force Update</button>
        </div>

        <!-- Player 2 Card -->
        <div class="card space-y-4">
            <h2 class="text-xl font-bold text-center text-orange-500" style="font-family: 'Oswald', sans-serif;">Player 2</h2>
            <div><label class="block mb-1 text-sm font-medium">Sponsor</label><input id="p2Sponsor" type="text" class="input-field"></div>
            <div><label class="block mb-1 text-sm font-medium">Tag</label><input id="p2Tag" type="text" class="input-field"></div>
            <div><label class="block mb-1 text-sm font-medium">Pronouns</label><input id="p2Pronouns" type="text" class="input-field"></div>
            <div><label class="block mb-1 text-sm font-medium">Status (L/W)</label><input id="p2Status" type="text" class="input-field" placeholder="e.g., Losers"></div>
            <div>
                <label class="block mb-1 text-sm font-medium">Score</label>
                <div class="flex items-center gap-2">
                    <button id="p2ScoreMinus" class="score-btn minus">-</button>
                    <input id="p2Score" type="number" class="input-field text-center" value="0">
                    <button id="p2ScorePlus" class="score-btn plus">+</button>
                </div>
            </div>
            <div><label class="block mb-1 text-sm font-medium">Character</label><select id="p2Character" class="input-field"></select></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // setDoc was missing from this import list, causing the error.
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { firebaseConfig } from './firebase-config.js';

        const characters = [
            "Banjo & Kazooie", "Bayonetta", "Bowser", "Bowser Jr.", "Byleth", "Captain Falcon", "Chrom", "Cloud", "Corrin", "Daisy",
            "Dark Pit", "Dark Samus", "Diddy Kong", "Donkey Kong", "Dr. Mario", "Duck Hunt", "Falco", "Fox", "Ganondorf",
            "Greninja", "Hero", "Ice Climbers", "Ike", "Incineroar", "Inkling", "Isabelle", "Jigglypuff", "Joker", "Kazuya",
            "Ken", "King Dedede", "King K. Rool", "Kirby", "Link", "Little Mac", "Lucario", "Lucas", "Lucina", "Luigi", "Mario",
            "Marth", "Mega Man", "Meta Knight", "Mewtwo", "Mii Brawler", "Mii Gunner", "Mii Swordfighter", "Min Min",
            "Mr. Game & Watch", "Ness", "Olimar", "Pac-Man", "Palutena", "Peach", "Pichu", "Pikachu", "Piranha Plant", "Pit",
            "Pyra and Mythra", "Richter", "Ridley", "R.O.B.", "Robin", "Rosalina & Luma", "Roy", "Ryu", "Samus", "Sephiroth",
            "Sheik", "Shulk", "Simon", "Snake", "Sora", "Sonic", "Steve", "Terry", "Toon Link", "Villager", "Wario",
            "Wii Fit Trainer", "Wolf", "Yoshi", "Young Link", "Zelda", "Zero Suit Samus"
        ];

        const p1CharField = document.getElementById('p1Character');
        const p2CharField = document.getElementById('p2Character');
        characters.forEach(char => {
            p1CharField.innerHTML += `<option value="${char}">${char}</option>`;
            p2CharField.innerHTML += `<option value="${char}">${char}</option>`;
        });

        const statusText = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        let db;
        const appId = 'stillwater-smash-overlay';
        let docRef;

        const setStatus = (text, color) => {
            statusText.textContent = text;
            statusDot.className = `w-3 h-3 ${color} rounded-full`;
        };

        const saveData = async () => {
            if (!db) return;
            const data = {
                p1Sponsor: document.getElementById('p1Sponsor').value,
                p1Tag: document.getElementById('p1Tag').value,
                p1Pronouns: document.getElementById('p1Pronouns').value,
                p1Status: document.getElementById('p1Status').value,
                p1Score: parseInt(document.getElementById('p1Score').value),
                p1Character: p1CharField.value,
                p2Sponsor: document.getElementById('p2Sponsor').value,
                p2Tag: document.getElementById('p2Tag').value,
                p2Pronouns: document.getElementById('p2Pronouns').value,
                p2Status: document.getElementById('p2Status').value,
                p2Score: parseInt(document.getElementById('p2Score').value),
                p2Character: p2CharField.value,
                round: document.getElementById('round').value,
                formatPrefix: document.getElementById('formatPrefix').value,
                formatNumber: document.getElementById('formatNumber').value,
            };
            try {
                await setDoc(docRef, data);
                setStatus('Connected & Synced', 'bg-green-500');
            } catch (error) {
                console.error("Failed to save data:", error);
                setStatus('Save Error', 'bg-red-500');
            }
        };

        const main = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                const auth = getAuth(app);
                await signInAnonymously(auth);

                docRef = doc(db, 'overlays', appId);

                onSnapshot(docRef, (doc) => {
                    const data = doc.exists() ? doc.data() : {};
                    // Logic to populate fields from snapshot can go here if needed
                });

                setStatus('Connected', 'bg-green-500');
            } catch (error) {
                console.error("DB Connection Failed:", error);
                setStatus('DB Connection Failed', 'bg-red-500');
            }
        };

        document.getElementById('forceUpdate').addEventListener('click', saveData);
        document.querySelectorAll('input, select').forEach(el => el.addEventListener('change', saveData));

        document.getElementById('p1ScorePlus').addEventListener('click', () => { document.getElementById('p1Score').value++; saveData(); });
        document.getElementById('p1ScoreMinus').addEventListener('click', () => { document.getElementById('p1Score').value--; saveData(); });
        document.getElementById('p2ScorePlus').addEventListener('click', () => { document.getElementById('p2Score').value++; saveData(); });
        document.getElementById('p2ScoreMinus').addEventListener('click', () => { document.getElementById('p2Score').value--; saveData(); });

        document.getElementById('swapPlayers').addEventListener('click', () => {
            const p1Fields = ['p1Sponsor', 'p1Tag', 'p1Pronouns', 'p1Status', 'p1Score', 'p1Character'];
            const p2Fields = ['p2Sponsor', 'p2Tag', 'p2Pronouns', 'p2Status', 'p2Score', 'p2Character'];
            p1Fields.forEach((id, i) => {
                const p1 = document.getElementById(id);
                const p2 = document.getElementById(p2Fields[i]);
                [p1.value, p2.value] = [p2.value, p1.value];
            });
            saveData();
        });

        main();
    </script>
</body>
</html>

