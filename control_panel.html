<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Slab', serif;
            background-color: #232323; /* Dark Gray BG */
            color: #f0f0f0;
        }
        .control-card {
            background-color: #2d2d2d;
            border: 1px solid #444;
        }
        input, select {
            background-color: #3a3a3a;
            border: 1px solid #555;
            color: #f0f0f0;
        }
        .btn-swap {
            background-color: #e0e0e0;
            color: #232323;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
        }
        .btn-update {
            background-color: #FF7300; /* OSU Orange */
            color: white;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
        }
        .player-header {
            font-family: 'Oswald', sans-serif;
            color: #FF7300;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 p-4 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold font-display" style="font-family: 'Oswald', sans-serif;">Overlay Control Panel</h1>
            <div id="connection-status" class="flex items-center gap-2 text-lg">
                <span>Connecting...</span>
                <div class="w-4 h-4 rounded-full bg-yellow-500 animate-pulse"></div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Player 1 -->
            <div class="control-card p-6 rounded-lg shadow-lg">
                <h2 class="player-header text-2xl mb-4">Player 1</h2>
                <div class="space-y-4">
                    <div>
                        <label for="p1Sponsor" class="block text-sm font-medium">Sponsor</label>
                        <input type="text" id="p1Sponsor" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label for="p1Tag" class="block text-sm font-medium">Tag</label>
                        <input type="text" id="p1Tag" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label for="p1Pronouns" class="block text-sm font-medium">Pronouns</label>
                        <input type="text" id="p1Pronouns" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label for="p1Status" class="block text-sm font-medium">Status (L/W)</label>
                        <input type="text" id="p1Status" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">Score</label>
                        <div class="flex items-center gap-2 mt-1">
                            <button id="p1ScoreDown" class="bg-red-600 w-10 h-10 text-xl font-bold rounded-md">-</button>
                            <input type="number" id="p1Score" class="w-full text-center p-2 rounded-md" value="0">
                            <button id="p1ScoreUp" class="bg-green-600 w-10 h-10 text-xl font-bold rounded-md">+</button>
                        </div>
                    </div>
                     <div>
                        <label class="block text-sm font-medium">Character</label>
                        <div class="flex items-center gap-2 mt-1">
                            <select id="p1Character" class="w-full p-2 rounded-md"></select>
                            <input type="number" id="p1Alt" min="1" max="8" value="1" class="w-20 text-center p-2 rounded-md" title="Alt Costume (1-8)">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Match Info -->
            <div class="control-card p-6 rounded-lg shadow-lg flex flex-col justify-center">
                 <h2 class="text-2xl mb-4 text-center" style="font-family: 'Oswald', sans-serif;">Match Info</h2>
                 <div class="space-y-4">
                     <div>
                        <label for="round" class="block text-sm font-medium">Round</label>
                        <input type="text" id="round" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label for="formatPrefix" class="block text-sm font-medium">Format</label>
                        <div class="flex items-center gap-2 mt-1">
                            <select id="formatPrefix" class="w-full p-2 rounded-md">
                                <option>Best of</option>
                                <option>First to</option>
                            </select>
                            <input type="number" id="formatNumber" class="w-24 text-center p-2 rounded-md" placeholder="e.g. 5">
                        </div>
                    </div>
                    <button id="swapButton" class="btn-swap w-full py-3 rounded-md text-lg font-bold mt-4">Swap Players</button>
                    <button id="forceUpdateButton" class="btn-update w-full py-3 rounded-md text-lg font-bold mt-2">Force Update</button>
                 </div>
            </div>

            <!-- Player 2 -->
            <div class="control-card p-6 rounded-lg shadow-lg">
                <h2 class="player-header text-2xl mb-4">Player 2</h2>
                <div class="space-y-4">
                    <div>
                        <label for="p2Sponsor" class="block text-sm font-medium">Sponsor</label>
                        <input type="text" id="p2Sponsor" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label for="p2Tag" class="block text-sm font-medium">Tag</label>
                        <input type="text" id="p2Tag" class="w-full mt-1 p-2 rounded-md">
                    </div>
                     <div>
                        <label for="p2Pronouns" class="block text-sm font-medium">Pronouns</label>
                        <input type="text" id="p2Pronouns" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label for="p2Status" class="block text-sm font-medium">Status (L/W)</label>
                        <input type="text" id="p2Status" class="w-full mt-1 p-2 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">Score</label>
                        <div class="flex items-center gap-2 mt-1">
                            <button id="p2ScoreDown" class="bg-red-600 w-10 h-10 text-xl font-bold rounded-md">-</button>
                            <input type="number" id="p2Score" class="w-full text-center p-2 rounded-md" value="0">
                            <button id="p2ScoreUp" class="bg-green-600 w-10 h-10 text-xl font-bold rounded-md">+</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium">Character</label>
                        <div class="flex items-center gap-2 mt-1">
                            <select id="p2Character" class="w-full p-2 rounded-md"></select>
                            <input type="number" id="p2Alt" min="1" max="8" value="1" class="w-20 text-center p-2 rounded-md" title="Alt Costume (1-8)">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { firebaseConfig } from './firebase-config.js';

        const p1ScoreUp = document.getElementById('p1ScoreUp');
        const p1ScoreDown = document.getElementById('p1ScoreDown');
        const p2ScoreUp = document.getElementById('p2ScoreUp');
        const p2ScoreDown = document.getElementById('p2ScoreDown');
        const swapButton = document.getElementById('swapButton');
        const forceUpdateButton = document.getElementById('forceUpdateButton');

        const characterNames = [
            "Banjo & Kazooie", "Bayonetta", "Bowser", "Bowser Jr.", "Byleth", "Captain Falcon", "Chrom", "Cloud", "Corrin", "Daisy",
            "Dark Pit", "Dark Samus", "Diddy Kong", "Donkey Kong", "Dr. Mario", "Duck Hunt", "Falco", "Fox", "Ganondorf", "Greninja",
            "Hero", "Ice Climbers", "Ike", "Incineroar", "Inkling", "Isabelle", "Jigglypuff", "Joker", "Kazuya", "Ken", "King Dedede",
            "King K. Rool", "Kirby", "Link", "Little Mac", "Lucario", "Lucas", "Lucina", "Luigi", "Mario", "Marth", "Mega Man",
            "Meta Knight", "Mewtwo", "Mii Brawler", "Mii Gunner", "Mii Swordfighter", "Min Min", "Mr. Game & Watch", "Ness", "Olimar",
            "Pac-Man", "Palutena", "Peach", "Pichu", "Pikachu", "Piranha Plant", "Pit", "Pyra and Mythra", "Richter", "Ridley",
            "R.O.B.", "Robin", "Rosalina & Luma", "Roy", "Ryu", "Samus", "Sephiroth", "Sheik", "Shulk", "Simon", "Snake", "Sora",
            "Sonic", "Steve", "Terry", "Toon Link", "Villager", "Wario", "Wii Fit Trainer", "Wolf", "Yoshi", "Young Link", "Zelda",
            "Zero Suit Samus"
        ];

        function populateCharacters() {
            const p1Select = document.getElementById('p1Character');
            const p2Select = document.getElementById('p2Character');
            characterNames.forEach(name => {
                const option1 = new Option(name, name);
                const option2 = new Option(name, name);
                p1Select.add(option1);
                p2Select.add(option2);
            });
        }
        populateCharacters();
        
        let db, docRef;

        const saveData = async () => {
            const data = {
                p1Sponsor: document.getElementById('p1Sponsor').value,
                p1Tag: document.getElementById('p1Tag').value,
                p1Pronouns: document.getElementById('p1Pronouns').value,
                p1Status: document.getElementById('p1Status').value,
                p1Score: parseInt(document.getElementById('p1Score').value),
                p1Character: document.getElementById('p1Character').value,
                p1Alt: document.getElementById('p1Alt').value,

                p2Sponsor: document.getElementById('p2Sponsor').value,
                p2Tag: document.getElementById('p2Tag').value,
                p2Pronouns: document.getElementById('p2Pronouns').value,
                p2Status: document.getElementById('p2Status').value,
                p2Score: parseInt(document.getElementById('p2Score').value),
                p2Character: document.getElementById('p2Character').value,
                p2Alt: document.getElementById('p2Alt').value,

                round: document.getElementById('round').value,
                formatPrefix: document.getElementById('formatPrefix').value,
                formatNumber: document.getElementById('formatNumber').value,
            };
            try {
                await setDoc(docRef, data);
            } catch (error) {
                console.error("Error saving data: ", error);
            }
        };

        const loadData = (data) => {
            document.getElementById('p1Sponsor').value = data.p1Sponsor || '';
            document.getElementById('p1Tag').value = data.p1Tag || '';
            document.getElementById('p1Pronouns').value = data.p1Pronouns || '';
            document.getElementById('p1Status').value = data.p1Status || '';
            document.getElementById('p1Score').value = data.p1Score ?? 0;
            document.getElementById('p1Character').value = data.p1Character || 'Mario';
            document.getElementById('p1Alt').value = data.p1Alt || 1;

            document.getElementById('p2Sponsor').value = data.p2Sponsor || '';
            document.getElementById('p2Tag').value = data.p2Tag || '';
            document.getElementById('p2Pronouns').value = data.p2Pronouns || '';
            document.getElementById('p2Status').value = data.p2Status || '';
            document.getElementById('p2Score').value = data.p2Score ?? 0;
            document.getElementById('p2Character').value = data.p2Character || 'Link';
            document.getElementById('p2Alt').value = data.p2Alt || 1;

            document.getElementById('round').value = data.round || '';
            document.getElementById('formatPrefix').value = data.formatPrefix || 'Best of';
            document.getElementById('formatNumber').value = data.formatNumber || '';
        };

        const swapPlayers = () => {
            const p1Data = {
                sponsor: document.getElementById('p1Sponsor').value,
                tag: document.getElementById('p1Tag').value,
                pronouns: document.getElementById('p1Pronouns').value,
                status: document.getElementById('p1Status').value,
                score: document.getElementById('p1Score').value,
                character: document.getElementById('p1Character').value,
                alt: document.getElementById('p1Alt').value,
            };
            const p2Data = {
                sponsor: document.getElementById('p2Sponsor').value,
                tag: document.getElementById('p2Tag').value,
                pronouns: document.getElementById('p2Pronouns').value,
                status: document.getElementById('p2Status').value,
                score: document.getElementById('p2Score').value,
                character: document.getElementById('p2Character').value,
                alt: document.getElementById('p2Alt').value,
            };

            document.getElementById('p1Sponsor').value = p2Data.sponsor;
            document.getElementById('p1Tag').value = p2Data.tag;
            document.getElementById('p1Pronouns').value = p2Data.pronouns;
            document.getElementById('p1Status').value = p2Data.status;
            document.getElementById('p1Score').value = p2Data.score;
            document.getElementById('p1Character').value = p2Data.character;
            document.getElementById('p1Alt').value = p2Data.alt;

            document.getElementById('p2Sponsor').value = p1Data.sponsor;
            document.getElementById('p2Tag').value = p1Data.tag;
            document.getElementById('p2Pronouns').value = p1Data.pronouns;
            document.getElementById('p2Status').value = p1Data.status;
            document.getElementById('p2Score').value = p1Data.score;
            document.getElementById('p2Character').value = p1Data.character;
            document.getElementById('p2Alt').value = p1Data.alt;

            saveData();
        };

        const updateStatus = (status, text, color, pulse) => {
            const statusDiv = document.getElementById('connection-status');
            statusDiv.innerHTML = `
                <span>${text}</span>
                <div class="w-4 h-4 rounded-full ${color} ${pulse ? 'animate-pulse' : ''}"></div>
            `;
        };

        const main = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                const auth = getAuth(app);
                await signInAnonymously(auth);

                const appId = 'stillwater-smash-overlay'; 
                docRef = doc(db, 'overlays', appId);

                onSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        loadData(doc.data());
                    }
                    updateStatus('sync', 'Connected & Synced', 'bg-green-500', false);
                });
            } catch (error) {
                console.error("Firebase connection error:", error);
                updateStatus('error', 'DB Connection Failed', 'bg-red-500', false);
            }
        };

        p1ScoreUp.addEventListener('click', () => { document.getElementById('p1Score').value++; saveData(); });
        p1ScoreDown.addEventListener('click', () => { document.getElementById('p1Score').value--; saveData(); });
        p2ScoreUp.addEventListener('click', () => { document.getElementById('p2Score').value++; saveData(); });
        p2ScoreDown.addEventListener('click', () => { document.getElementById('p2Score').value--; saveData(); });
        swapButton.addEventListener('click', swapPlayers);
        forceUpdateButton.addEventListener('click', saveData);

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('change', saveData);
        });

        main();
    </script>
</body>
</html>

